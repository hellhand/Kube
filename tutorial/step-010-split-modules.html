<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Task 010 – Split vk_app into Modules</title>
  <link rel="stylesheet" href="shared.css">
</head>
<body>
<main>
  <header>
    <h1>Task 010 – Split vk_app into Modules</h1>
    <p class="lead">Refactor the monolithic app into focused files while keeping behavior identical.</p>
  </header>
  <section>
    <div class="badge">Suggested split</div>
    <ul>
      <li><code>vk_app.go</code>: core types, init orchestration, draw loop, cleanup.</li>
      <li><code>vk_texture.go</code>: texture loading/parsing (PPM), image/view/sampler creation.</li>
      <li><code>vk_overlay.go</code>: overlay pipeline, buffers, FPS generation/draw.</li>
      <li>(Optional) further splits: swapchain/render-pass/pipeline setup vs. buffer/descriptor creation vs. commands/recording.</li>
    </ul>
  </section>
  <section>
    <h2>Guidelines</h2>
    <ul>
      <li>Keep package <code>main</code> for all files; avoid circular deps.</li>
      <li>Minimize imports per file; move helpers near their usage.</li>
      <li>Ensure cleanup/recreation paths still destroy/free resources correctly.</li>
      <li>Run <code>go build ./...</code> after refactor to verify no behavior changes.</li>
    </ul>
<pre><code class="language-bash"># Example split already present:
vk_app.go       # core orchestration, draw loop, cleanup
vk_texture.go   # texture loading, image/view/sampler
vk_overlay.go   # HUD pipeline, buffers, FPS text</code></pre>
  </section>
  <section>
    <h2>How to do it safely</h2>
    <ol>
      <li>Identify cohesive groups: texture helpers (<code>createImage</code>, <code>transitionImageLayout</code>, PPM parsing) move together; overlay helpers (bitmap font, overlay buffers) move together.</li>
      <li>Keep shared types (<code>VulkanApp</code>, <code>vertex</code>, <code>uniformBufferObject</code>) in one file to avoid import cycles.</li>
      <li>After moving functions, search for <code>TODO:</code> or compilation errors and fix missing method receivers or imports.</li>
      <li>Re-run swapchain recreation and cleanup paths to ensure all new files still export the needed functions.</li>
    </ol>
<pre><code class="language-go">// Example: keep shared types central
// vk_app.go
type VulkanApp struct {
  // ...
  textureImage vulkan.Image
  overlayPipeline vulkan.Pipeline
}

// vk_texture.go (same package main, so these have method receivers)
func (a *VulkanApp) createTextureResources() error { /* ... */ }</code></pre>
    <p>Commit after the split once <code>go run .</code> still produces the textured cube with overlay.</p>
  </section>
  <div class="nav"><a href="index.html">← Back to Hub</a></div>
</main>
</body>
</html>
